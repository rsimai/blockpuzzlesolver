#!/usr/bin/python

import copy
import time

#testarrays

pieces = 3
xmax = 4
ymax = 4

array = [[" " for x in range(xmax)] for y in range(ymax)]
piece = [" " for x in range(pieces)]

array = [[' ', ' ', ' ', ' '],
         [' ', ' ', ' ', ' '],
         [' ', ' ', ' ', ' '],
         [' ', ' ', ' ', ' ']]


#piece[2] = [(0,0),(1,0),(2,0),(3,0),(0,1)]
#piece[1] = [(1,0),(2,0),(3,0),(0,1),(1,1),(2,1)]
#piece[0] = [(3,0),(0,1),(1,1),(2,1),(3,1)]


piece[2] = [(0,0),(1,0),(0,1),(1,1),(0,2),(0,3)]
piece[1] = [(0,0),(1,0),(0,1),(1,1)]
piece[0] = [(0,0),(1,0),(2,0),(0,1),(1,1),(2,1)]

def printarray(myarray):
    delimiter = ''
    for y in range(ymax+2):
        delimiter = delimiter + "*"
    print(delimiter)
    for y in range(ymax):
        outline = "*"
        for x in range(xmax):
            outline = outline + str(myarray[x][y])
        outline = outline + "*"
        print(outline)
    print(delimiter)
    return

def checkpiece(mypiece):
    xrot = xmax
    yrot = ymax
    xsize = 0
    ysize = 0
    for i in mypiece:
        if i[0] >= xsize:
            xsize = i[0] + 1
        if i[1] >= ysize:
            ysize = i[1] + 1
    xrot = xmax - xsize
    yrot = ymax - ysize
    time.sleep(0.5)
    return xrot, yrot



def main_loop(mymatrix, level, status):
    newmatrix = copy.deepcopy(mymatrix)
    #print "DEBUG: loop starts"
    #print "DEBUG: level", level
    #print "DEBUG: mymatrix ", mymatrix
    #print "DEBUG: newmatrix", newmatrix
    #print "DEBUG: status", status
    if level == pieces:
        if status == 'success':
            print "We're done, it's resolved!"
            printarray(mymatrix)
            exit(0)
        else:
            print "No final match! Something's wrong with the data."
            exit(1)
    mypiece = piece[level]
    xrot, yrot = checkpiece(mypiece)
    #print "DEBUG: piece verified: mypiece, level, xrot, yrot:", mypiece, level, xrot, yrot
    status = 'success'
    y = 0
    #print "DEBUG: start y loop to", yrot
    while y <= yrot:
        #print "DEBUG: y", y
        #print "DEBUG: start x loop to", xrot
        x = 0
        while x <= xrot:
            #print "DEBUG: x", x
            piecestatus = 'success'
            #print "DEBUG: mymatrix ", mymatrix
            #print "DEBUG: newmatrix", newmatrix
            #print "DEBUG: checking mypiece:", mypiece
            for i in mypiece:
                xcheck = i[0] + x
                ycheck = i[1] + y
                #print "DEBUG: analyzing pos x, y:", xcheck, ycheck
                if newmatrix[xcheck][ycheck] != " ":
                    #print "DEBUG: fail, there's a conflict at", xcheck, ycheck, "'", newmatrix[xcheck][ycheck], "'"
                    piecestatus = 'fail'
                    newmatrix = copy.deepcopy(mymatrix)
                    break
                else:
                    #print "DEBUG: block matches, write to newmatrix at", xcheck, ycheck
                    newmatrix[xcheck][ycheck] = str(level)
            if piecestatus == 'success':
                for i in mypiece:
                    xcheck = i[0] + x
                    ycheck = i[1] + y
                    newmatrix[xcheck][ycheck] = str(level)
                printarray(newmatrix)
                #print "DEBUG: call next level:", level +1
                #print "DEBUG: mymatrix ", mymatrix
                #print "DEBUG: newmatrix", newmatrix
                
                newmatrix, level, status = main_loop(newmatrix, level + 1, 'success')
                if status == 'fail':
                    newmatrix = copy.deepcopy(mymatrix)
            else:
                #print "DEBUG: this won't fit, reset matrix, try next pos"
                #print "DEBUG: mymatrix ", mymatrix
                #print "DEBUG: newmatrix", newmatrix
                newmatrix = copy.deepcopy(mymatrix)
            if status == 'fail':
                # continue
                #print "DEBUG: had to go back one level, revert changes..."
                #print "DEBUG: mymatrix ", mymatrix
                #print "DEBUG: newmatrix", newmatrix
                newmatrix = copy.deepcopy(mymatrix)
            x += 1
        y += 1
    #print "DEBUG: failed, will need to go back ..."
    status = 'fail'
    return(mymatrix, level - 1, status)

array, level, status = main_loop(array, 0, 'success')

